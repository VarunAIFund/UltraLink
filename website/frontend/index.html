<!DOCTYPE html>
<html>
<head>
    <title>Candidate Search</title>
</head>
<body>
    <h1>Candidate Search & Ranking</h1>

    <div>
        <h2>Search</h2>
        <input type="text" id="query" placeholder="e.g., CEO in healthcare with startup experience" size="60">
        <button onclick="searchAndRank()">Search & Rank</button>
    </div>

    <div id="loading" style="display:none;">
        <p>Loading...</p>
    </div>

    <div id="results">
        <h2>Results</h2>
        <div id="sql"></div>
        <div id="candidates"></div>
    </div>

    <script>
        async function searchAndRank() {
            const query = document.getElementById('query').value;

            if (!query) {
                alert('Please enter a query');
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';

            try {
                const response = await fetch('http://localhost:5000/search-and-rank', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: query })
                });

                const data = await response.json();

                // Hide loading
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').style.display = 'block';

                if (data.error) {
                    document.getElementById('candidates').innerHTML = '<p>Error: ' + data.error + '</p>';
                    return;
                }

                // Display SQL
                document.getElementById('sql').innerHTML = '<h3>Generated SQL:</h3><pre>' + data.sql + '</pre>';

                // Display candidates
                let html = '<h3>Candidates (' + data.total + ' results)</h3>';

                data.results.forEach((candidate, index) => {
                    html += '<div>';
                    html += '<h4>' + (index + 1) + '. ' + candidate.name + '</h4>';
                    html += '<p><strong>Score:</strong> ' + (candidate.relevance_score || 'N/A') + '</p>';
                    html += '<p><strong>LinkedIn:</strong> <a href="' + candidate.linkedin_url + '" target="_blank">' + candidate.linkedin_url + '</a></p>';
                    html += '<p><strong>Headline:</strong> ' + (candidate.headline || 'N/A') + '</p>';
                    html += '<p><strong>Location:</strong> ' + (candidate.location || 'N/A') + '</p>';
                    html += '<p><strong>Seniority:</strong> ' + (candidate.seniority || 'N/A') + '</p>';
                    html += '<p><strong>Why good fit:</strong> ' + (candidate.fit_description || 'N/A') + '</p>';
                    html += '<hr>';
                    html += '</div>';
                });

                document.getElementById('candidates').innerHTML = html;

            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').style.display = 'block';
                document.getElementById('candidates').innerHTML = '<p>Error: ' + error.message + '</p>';
            }
        }

        // Allow Enter key to search
        document.getElementById('query').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                searchAndRank();
            }
        });
    </script>
</body>
</html>
